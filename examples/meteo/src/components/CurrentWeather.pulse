/**
 * CurrentWeather Component - Display current weather data
 */

@page CurrentWeather

props {
  weather: null
  loading: false
  error: null
  unit: "celsius"
  isFavorite: false
  onToggleUnit: null
  onToggleFavorite: null
}

view {
  .current-weather {
    @if (loading) {
      .loading "â³ Loading..."
    }
    @if (error && !loading) {
      .error "âŒ {error}"
    }
    @if (!weather && !loading && !error) {
      .placeholder "ğŸŒ Search for a city to see weather"
    }
    @if (weather && !loading && !error) {
      .weather-header {
        h2.location "{weather.city}, {weather.country}"
        button.fav-btn[title="{isFavorite ? 'Remove from favorites' : 'Add to favorites'}"] @click(onToggleFavorite && onToggleFavorite()) "{isFavorite ? 'â­' : 'â˜†'}"
      }
      .weather-main {
        .weather-icon "{getWeatherIcon(weather.code)}"
        .temp-container {
          .temperature[title="Click to toggle Â°C/Â°F"] @click(onToggleUnit && onToggleUnit()) "{convertTemp(weather.temp)}{getUnitSymbol()}"
          .weather-desc "{getWeatherDesc(weather.code)}"
        }
      }
      .weather-details {
        .detail {
          .detail-icon "ğŸŒ¡ï¸"
          .detail-label "Feels like"
          .detail-value "{convertTemp(weather.feelsLike)}{getUnitSymbol()}"
        }
        .detail {
          .detail-icon "ğŸ’§"
          .detail-label "Humidity"
          .detail-value "{weather.humidity}%"
        }
        .detail {
          .detail-icon "ğŸ’¨"
          .detail-label "Wind"
          .detail-value "{weather.windSpeed} km/h"
        }
        .detail {
          .detail-icon "ğŸ§­"
          .detail-label "Direction"
          .detail-value "{weather.windDir}Â°"
        }
      }
    }
  }
}

actions {
  getWeatherCodes() {
    return {
      0: { icon: "â˜€ï¸", desc: "Clear sky" },
      1: { icon: "ğŸŒ¤ï¸", desc: "Mainly clear" },
      2: { icon: "â›…", desc: "Partly cloudy" },
      3: { icon: "â˜ï¸", desc: "Overcast" },
      45: { icon: "ğŸŒ«ï¸", desc: "Foggy" },
      48: { icon: "ğŸŒ«ï¸", desc: "Depositing rime fog" },
      51: { icon: "ğŸŒ§ï¸", desc: "Light drizzle" },
      53: { icon: "ğŸŒ§ï¸", desc: "Moderate drizzle" },
      55: { icon: "ğŸŒ§ï¸", desc: "Dense drizzle" },
      61: { icon: "ğŸŒ§ï¸", desc: "Slight rain" },
      63: { icon: "ğŸŒ§ï¸", desc: "Moderate rain" },
      65: { icon: "ğŸŒ§ï¸", desc: "Heavy rain" },
      71: { icon: "â„ï¸", desc: "Slight snow" },
      73: { icon: "â„ï¸", desc: "Moderate snow" },
      75: { icon: "â„ï¸", desc: "Heavy snow" },
      80: { icon: "ğŸŒ¦ï¸", desc: "Slight rain showers" },
      81: { icon: "ğŸŒ¦ï¸", desc: "Moderate rain showers" },
      82: { icon: "â›ˆï¸", desc: "Violent rain showers" },
      95: { icon: "â›ˆï¸", desc: "Thunderstorm" },
      96: { icon: "â›ˆï¸", desc: "Thunderstorm with slight hail" },
      99: { icon: "â›ˆï¸", desc: "Thunderstorm with heavy hail" }
    }
  }

  getWeatherIcon(code) {
    const codes = getWeatherCodes()
    return codes[code] ? codes[code].icon : "â“"
  }

  getWeatherDesc(code) {
    const codes = getWeatherCodes()
    return codes[code] ? codes[code].desc : "Unknown"
  }

  convertTemp(celsius) {
    if (unit === "fahrenheit") {
      return Math.round(celsius * 9/5 + 32)
    }
    return celsius
  }

  getUnitSymbol() {
    return unit === "celsius" ? "Â°C" : "Â°F"
  }
}

style {
  .current-weather {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 32px;
    box-shadow: var(--shadow);
    animation: fadeIn 0.4s ease;
  }

  .loading, .error, .placeholder {
    text-align: center;
    padding: 48px;
    font-size: 1.2em;
    color: var(--text-light);
  }

  .error {
    color: #e74c3c;
  }

  .weather-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }

  .location {
    font-size: 1.5em;
  }

  .fav-btn {
    font-size: 1.5em;
    background: none;
    border: none;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .fav-btn:hover {
    transform: scale(1.2);
  }

  .weather-main {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 32px;
  }

  .weather-icon {
    font-size: 5em;
  }

  .temp-container {
    flex: 1;
  }

  .temperature {
    font-size: 4em;
    font-weight: 300;
    cursor: pointer;
    transition: color 0.2s;
  }

  .temperature:hover {
    color: var(--primary);
  }

  .weather-desc {
    font-size: 1.2em;
    color: var(--text-light);
    margin-top: 4px;
  }

  .weather-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 16px;
  }

  .detail {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 12px;
    text-align: center;
  }

  .detail-icon {
    font-size: 1.5em;
    margin-bottom: 8px;
  }

  .detail-label {
    font-size: 0.85em;
    color: var(--text-light);
    margin-bottom: 4px;
  }

  .detail-value {
    font-size: 1.1em;
    font-weight: 600;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
}
